<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ôn tập Giữa kì I – Toán 8 (chuẩn fix)</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net" />
<style>
  :root{
    --bg:#f6f8fc;--card:#fff;--ink:#0f172a;--muted:#64748b;--brand:#2563eb;--ok:#10b981;--bad:#ef4444;--hint:#e0f2fe;--ring:#e5e7eb
  }
  html,body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto}
  .wrap{max-width:980px;margin:auto;padding:20px}
  h1{font-weight:800;letter-spacing:.2px;text-align:center;margin:10px 0 8px}
  .sub{color:var(--muted);text-align:center;margin:0 0 18px}
  .toolbar{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin:10px 0 18px}
  button{border:0;border-radius:12px;padding:9px 14px;font-weight:700;cursor:pointer}
  .btn{background:var(--brand);color:#fff}
  .btn-ghost{background:#e5e7eb}
  .btn-soft{background:#dbeafe}
  .kbd{font:600 12px/1.2 ui-monospace,Menlo,Consolas;background:#111827;color:#fff;padding:2px 6px;border-radius:6px}
  .card{background:var(--card);border-radius:16px;box-shadow:0 6px 22px rgba(0,0,0,.06);padding:16px 18px;margin:14px 0}
  .card h2{margin:6px 0 10px;font-size:20px}
  .stem{font-weight:700;margin-bottom:10px}
  .opt{display:flex;gap:10px;align-items:flex-start;padding:8px 10px;border-radius:12px;transition:box-shadow .15s,background .15s}
  .opt:hover{box-shadow:0 0 0 2px var(--ring) inset}
  .opt input{margin-top:4px}
  .hint{background:var(--hint);border-radius:12px;padding:10px 12px;margin-top:10px;display:none}
  .figure{max-width:100%;height:auto;border-radius:10px;display:block;margin:6px 0}
  .badge{display:inline-block;font:700 12px/1 ui-sans-serif;padding:6px 10px;border-radius:999px}
  .ok{background:#ecfdf5;color:#065f46}
  .bad{background:#fef2f2;color:#991b1b}
  .muted{background:#f1f5f9;color:#334155}
  .sec-title{font-size:22px;font-weight:900;text-align:center;margin:30px 0 8px}
  .lead{color:var(--muted);text-align:center;margin:0 0 14px}
  .meta{color:var(--muted);text-align:center;margin:6px 0}
  .score{background:#eef2ff;border-radius:12px;padding:8px 12px;display:inline-block}
  .grid{display:grid;gap:12px}
  @media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
</style>
<!-- MathJax 3 -->
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" defer></script>
</head>
<body>
<div class="wrap">
  <h1>Ôn tập Giữa kì I – Toán 8</h1>
  <p id="progress" class="sub" aria-live="polite">Đang tải dữ liệu…</p>

  <div class="toolbar">
    <button class="btn-ghost" id="btnResetKeep">Làm lại (giữ thứ tự)</button>
    <button class="btn" id="btnResetShuffle">Làm lại (xáo trộn)</button>
    <button class="btn-soft" id="btnOnlyWrong">Làm lại (chỉ câu sai)</button>
  </div>

  <div class="sec-title">PHẦN TRẮC NGHIỆM</div>
  <p class="lead">Chọn <b>1</b> đáp án đúng cho mỗi câu. Sau khi chọn, câu sẽ được khóa để đảm bảo công bằng khi chấm.</p>
  <div id="mcqs" class="grid" ></div>

  <div class="sec-title">PHẦN ĐÚNG/SAI</div>
  <p class="lead">Đọc kĩ từng mệnh đề và <b>tick vào các mệnh đề ĐÚNG</b>. Hệ thống sẽ báo màu ngay từng dòng. Có thể bật <span class="kbd">Gợi ý</span> để xem định hướng.</p>
  <div id="ds"></div>

  <div class="toolbar">
    <button class="btn-ghost" id="btnResetKeep2">Làm lại (giữ thứ tự)</button>
    <button class="btn" id="btnResetShuffle2">Làm lại (xáo trộn)</button>
  </div>
</div>

<script id="quiz-data" type="application/json">
{
  "mcqs": [
    {"id":"M1","stem":"Trong các biểu thức sau, <b>đơn thức</b> là:","img":null,
      "options":["\\(2x^{2}+3y\\)","\\(\\dfrac{2}{3xy}\\)","\\((-5)\\,x^{2}y^{3}\\)","\\(x^{2}-2x\\)"],"answer":2,
      "hint":"Đơn thức là tích của một số với các biến có số mũ nguyên không âm; không có phép cộng/trừ."},
    {"id":"M2","stem":"Trong các biểu thức sau, <b>đa thức</b> là:","img":null,
      "options":["\\(\\dfrac{2}{x^{3}y}-1\\)","\\(\\dfrac{x}{y}+3\\)","\\(5x-4y+7\\)","\\(x^{2}y+\\dfrac{1}{x}\\)"],"answer":2,
      "hint":"Đa thức là tổng/hợp của các đơn thức có số mũ nguyên không âm (không có biến ở mẫu)."},
    {"id":"M3","stem":"Đơn thức <b>đồng dạng</b> với \\tfrac{2}{3}xyz là:","img":null,
      "options":["\\(\\tfrac{3}{2}xyz\\)","\\(2x^{2}yz\\)","\\(2xy^{2}z\\)","\\(\\tfrac{2}{3}x^{2}y^{2}z\\)"],"answer":0,
      "hint":"Đồng dạng ⇔ cùng phần biến và cùng số mũ từng biến; hệ số có thể khác."},
    {"id":"M4","stem":"Kết quả phép trừ \\tfrac{5}{2}xy-\\tfrac{1}{2}xy là:","img":null,
      "options":["\\(2xy\\)","\\(3xy\\)","\\(\\tfrac{2}{3}xy\\)","\\(\\tfrac{4}{2}xy\\)"],"answer":0,
      "hint":"Cùng đơn thức \\((xy)\\): \\((\\tfrac{5}{2}-\\tfrac{1}{2})xy=2xy\\)."},
    {"id":"M5","stem":"Kết quả phép chia \\dfrac{x^{2}y^{3}}{xy} là:","img":null,
      "options":["\\(xy^{2}\\)","\\(x^{3}y^{3}\\)","\\(x\\,y^{2}\\)","\\(x\\,y^{4}\\)"],"answer":0,
      "hint":"Trừ số mũ theo từng biến: \\x^{2}:x=x, \\y^{3}:y=y^{2}."},
    {"id":"M6","stem":"Biết \\(M+5x^{2}-2xy=6x^{2}+10xy-y^{2}\\). Khi đó \\(M\\) bằng:","img":null,
      "options":["\\(x^{2}+12xy-y^{2}\\)","\\(x^{2}+12xy+y^{2}\\)","\\(x^{2}+8xy-y^{2}\\)","\\(x^{2}+7xy-y^{2}\\)"],"answer":0,
      "hint":"\\(M=(6x^{2}+10xy-y^{2})-(5x^{2}-2xy)=x^{2}+12xy-y^{2}\\)."},
    {"id":"M7","stem":"Diện tích hình chữ nhật có dài \\(x+2\\), rộng \\(y+3\\) là:","img":null,
      "options":["\\(xy+3x+2y+6\\)","\\(xy-3x+2y+6\\)","\\(xy+3x-2y+6\\)","\\(xy-3x+2y-6\\)"],"answer":0,
      "hint":"\\(S=(x+2)(y+3)=xy+3x+2y+6\\)."},
    {"id":"M8","stem":"Trong các đơn thức sau, <b>đơn thức đã thu gọn</b> là:","img":null,
      "options":["\\(3\\cdot x\\cdot x\\cdot y\\)","\\(\\tfrac{1}{4}\\cdot 4x^{2}y\\)","\\(2^{3}\\cdot 3^{4}\\,x y^{2}z\\)","\\(2^{2}\\cdot 3\\cdot x\\cdot y\\cdot x\\cdot z\\)"],"answer":2,
      "hint":"Thu gọn = gộp lũy thừa cùng biến & rút gọn hệ số. (A)(D) chưa gộp biến; (B) rút gọn hệ số thành 1; (C) đã gộp đầy đủ."},
    {"id":"M9","stem":"Trong các hình sau, <b>hình vuông</b> là:","img":"img/cau9.png",
      "options":["Hình 1","Hình 2","Hình 3","Hình 4"],"answer":1,
      "hint":"Hình vuông: bốn góc vuông và bốn cạnh bằng nhau."},
    {"id":"M10","stem":"Cho tứ giác \\((ABCD)\\) trong <b>hình 1</b>. Biết \\widehat{ABC}=120^{\\circ}. Số đo \\widehat{ADC} là:","img":"img/cau10.png",
      "options":["\\(360^{\\circ}\\)","\\(180^{\\circ}\\)","\\(120^{\\circ}\\)","\\(60^{\\circ}\\)"],"answer":3,
      "hint":"Hai góc kề một cạnh trong tứ giác bù nhau (theo hình): \\widehat{ABC}+\\widehat{ADC}=180^{\\circ}\\Rightarrow\\widehat{ADC}=60^{\\circ}."},
    {"id":"M11","stem":"Biết tứ giác \\((MNPQ)\\) là <b>hình thang</b> (hình 2). Khi nào là <b>hình thang cân</b>?","img":"img/cau11.png",
      "options":["\\(MQ=NP\\)","\\(NQ=4\\,\\text{cm}\\)","\\(NQ=2\\,\\text{cm}\\)","\\(NQ=5\\,\\text{cm}\\)"],"answer":0,
      "hint":"Hình thang cân: hai cạnh bên bằng nhau; (tương đương) hai góc ở cùng một đáy bằng nhau; thường có hai đường chéo bằng nhau."},
    {"id":"M12","stem":"Cho hình bình hành \\((EFGH)\\) (hình 3). <b>Mệnh đề đúng</b> là:","img":"img/cau12.png",
      "options":["\\(EF\\parallel HG\\) và \\(EH\\parallel FG\\)","Hai đường chéo vuông góc","Hai đường chéo bằng nhau","Bốn cạnh bằng nhau"],"answer":0,
      "hint":"HBH: cặp cạnh đối song song và bằng nhau; chéo cắt nhau tại trung điểm. Không nhất thiết chéo bằng nhau/vuông góc."},
    {"id":"M13","stem":"Trong các hình a–d (hình 4), <b>tứ giác lồi</b> là:","img":"img/cau13.png",
      "options":["Hình a","Hình b","Hình c","Hình d"],"answer":0,
      "hint":"Tứ giác lồi: bốn góc <180^{\\circ}, không tự cắt; các đường chéo cắt nhau bên trong tứ giác."},
    {"id":"M14","stem":"Tứ giác \\((ABCD)\\) trong <b>hình 5</b> là hình gì?","img":"img/cau14.png",
      "options":["Hình vuông","Hình thoi","Hình chữ nhật","Hình tam giác"],"answer":2,
      "hint":"Có góc vuông, cạnh đối song song; đường chéo bằng nhau ⇒ hình chữ nhật."},
    {"id":"M15","stem":"Không phải <b>dấu hiệu nhận biết hình thoi</b> là:","img":null,
      "options":["HBH có hai cạnh kề bằng nhau ⇒ hình thoi","HBH có hai đường chéo vuông góc ⇒ hình thoi","HBH có hai đường chéo bằng nhau ⇒ hình thoi","HBH có một đường chéo là phân giác một góc ⇒ hình thoi"],"answer":2,
      "hint":"Hình thoi: 4 cạnh bằng nhau. Dấu hiệu đúng: (1)(2)(4). Chéo bằng nhau là dấu hiệu của hình chữ nhật."},
    {"id":"M16","stem":"Hình thoi có <b>một góc vuông</b> là:","img":null,
      "options":["Hình vuông","Hình bình hành","Hình chữ nhật","Hình thang cân"],"answer":0,
      "hint":"Hình thoi + 1 góc vuông ⇒ 4 cạnh bằng nhau và có góc vuông ⇒ hình vuông."},
    {"id":"M17","stem":"Tứ giác trong <b>hình 2</b> là:","img":"img/cau17.png",
      "options":["Hình thoi","Hình vuông","Hình thang cân","Hình chữ nhật"],"answer":3,
      "hint":"Dấu hiệu HCN: hai đường chéo bằng nhau (theo hình)."}
  ],

  "ds": [
    {"id":"B1","title":"Bài 1: Rút gọn đơn thức – hệ số & bậc (tick các mệnh đề ĐÚNG).","img":null,
      "items":[
        ["Đơn thức \\(5x^{3}\\cdot xy=5x^{4}y\\).",1],
        ["Bậc của \\(5x^{4}y\\) là \\((6)\\).",0],
        ["\\((4x^{2})(-4xy)=-16x^{3}y\\).",1],
        ["\\(\\dfrac{1}{4}xyz\\cdot(2xy)=\\dfrac{1}{2}x^{2}y^{2}z\\).",1],
        ["Bậc của \\((1/2)x^{2}y^{2}z\\) là 5.",0],
        ["Thu gọn \\(x\\cdot x\\cdot y=x^{2}y\\).",1],
        ["\\(5x^{2}y^{-1}\\) là đơn thức hợp lệ của đa thức.",0],
        ["Hệ số của \\(-16x^{3}y\\) là \\(-16\\).",1],
        ["Bậc của \\(-16x^{3}y\\) là 3.",1],
        ["Bậc đơn thức là <b>tổng số mũ các biến</b> (không âm).",1]
      ],
      "hint":"Bậc = tổng số mũ của biến (không âm); mũ âm → không là đơn thức hợp lệ trong đa thức."},
    {"id":"B2","title":"Bài 2: Hạng tử của đa thức (tick ĐÚNG).","img":null,
      "items":[
        ["Hạng tử là mỗi đơn thức trong đa thức.",1],
        ["\\(A=x^{4}+xy+\\tfrac{2}{3}\\) là đa thức có 3 hạng tử.",1],
        ["Trong đa thức, các hạng tử <b>đồng dạng</b> có thể cộng gộp.",1],
        ["\\(x/y\\) là một hạng tử hợp lệ trong đa thức.",0],
        ["Đa thức có thể có hệ số phân số.",1],
        ["\\(5x-3+2x=7x-3\\).",1],
        ["Bậc đa thức là bậc của hạng tử <b>nhỏ nhất</b>.",0],
        ["Bậc đa thức là bậc của hạng tử <b>lớn nhất</b>.",1],
        ["\\((-2)x^{2}y\\) và \\(2(-x^{2}y)\\) là hạng tử đồng dạng.",1],
        ["Có thể sắp xếp hạng tử theo lũy thừa giảm dần.",1]
      ],
      "hint":"Đa thức không có biến ở mẫu; bậc đa thức = bậc hạng tử lớn nhất."},
    {"id":"B3","title":"Bài 3: Cộng – trừ – nhân – chia (tick ĐÚNG).","img":null,
      "items":[
        ["\\(4xy-8xy=-4xy\\).",1],
        ["\\(4xy-16xy=-12xy\\).",1],
        ["\\(10xy:5xy=2\\).",1],
        ["\\((3xy-12xy):3xy=-3\\).",1],
        ["\\(3x^{2}y+4x-2x=3x^{2}y+2x\\).",1],
        ["\\((4xy-5x^{2})+(2xy-5x^{2})=6xy-10x^{2}\\).",1],
        ["\\(x^{2}y+x^{2}y=2x^{2}y\\).",1],
        ["\\(\\dfrac{x^{2}y}{xy}=x\\).",1],
        ["\\(\\dfrac{4x^{2}y}{2xy}=2x\\).",1],
        ["\\(\\dfrac{x^{2}y}{x^{2}}=y\\).",1]
      ],
      "hint":"Cộng/trừ: gộp hạng tử đồng dạng. Nhân: cộng mũ theo từng biến. Chia: trừ mũ tương ứng."},
    {"id":"B4","title":"Bài 4: Giá trị đa thức – thay số (tick ĐÚNG).","img":null,
      "items":[
        ["Với \\(x=1,y=2\\), \\(A(x,y)=3x^{2}+5xy\\Rightarrow A=13\\).",1],
        ["Với \\(x=2,y=1\\), \\(B=2x^{2}-xy+x^{2}y-3xy+2xy=9\\).",0],
        ["Thay số tuân thủ thứ tự: lũy thừa → nhân/chia → cộng/trừ.",1],
        ["Giá trị đa thức không phụ thuộc thứ tự gộp hạng tử <b>đúng quy tắc</b>.",1],
        ["Rút gọn trước khi thay số để hạn sai.",1],
        ["Nếu \\(y=0\\) thì mọi hạng tử chứa \\(y\\) đều bằng 0.",1],
        ["Nếu \\(x=-1\\) thì \\(x^{2}=1\\).",1],
        ["Lỗi thường gặp: quên bình phương cả biến lẫn hệ số.",1],
        ["Lỗi thường gặp: sai thứ tự ưu tiên phép tính.",1]
      ],
      "hint":"Khuyến nghị rút gọn trước, rồi thay số; chú ý bậc & quy tắc ưu tiên."},
    {"id":"B5","title":"Bài 5: Tìm đa thức \\(M\\) (dạng \\(M+P=Q\\)) (tick ĐÚNG).","img":null,
      "items":[
        ["\\(M=Q-P\\).",1],
        ["Trừ đa thức = cộng với <b>đối</b> của đa thức trừ.",1],
        ["\\((6x^{2}+10xy-y^{2})-(5x^{2}-2xy)=x^{2}+12xy-y^{2}\\).",1],
        ["Hạng tử không đồng dạng giữ nguyên khi cộng/trừ.",1],
        ["Có thể sắp xếp theo lũy thừa giảm dần của \\(x\\).",1],
        ["\\((a+b)-(c+d)=a+b-c-d\\).",1],
        ["\\((a+b)-(c-d)=a+b-c+d\\).",1],
        ["Không cần ngoặc khi trừ đa thức.",0],
        ["\\(M\\) luôn đồng dạng với \\(P\\).",0],
        ["\\(M\\) luôn đồng dạng với \\(Q\\).",0]
      ],
      "hint":"Nguyên tắc: \\(M=Q-P\\). Khi trừ phải đổi dấu hạng tử của đa thức trừ."},
    {"id":"B6","title":"Bài 6: Chia hết đa thức (định lý phần dư) (tick ĐÚNG).","img":null,
      "items":[
        ["\\(A=8x^{2}-6x+m\\) <b>chia hết</b> cho \\(2x-3\\).",0],
        ["Điều kiện chia hết: \\(A(x)=(2x-3)\\cdot Q(x)\\).",1],
        ["Thay \\(x=\\tfrac{3}{2}\\) vào \\(A(x)\\) để kiểm tra \\(A(\\tfrac{3}{2})=0\\).",1],
        ["Nếu \\(A(\\tfrac{3}{2})=0\\) thì \\(A\\) chia hết cho \\(2x-3\\).",1],
        ["Có thể tìm \\(m\\) bằng điều kiện \\(A(\\tfrac{3}{2})=0\\).",1],
        ["Nếu \\(A'=kA\\) thì \\(A'\\) cũng chia hết cho \\(2x-3\\).",1],
        ["\\(A(0)=0\\Rightarrow A\\) chia hết cho \\(x\\).",1],
        ["Mọi đa thức đều chia hết cho \\(2x-3\\).",0],
        ["Nếu không chia hết thì \\(A(\\tfrac{3}{2})\\neq 0\\).",1]
      ],
      "hint":"Định lý phần dư: \\(A(x)\\) chia hết cho \\(x-a\\) ⇔ \\(A(a)=0\\). Với \\(2x-3\\) thì \\(a=\\tfrac{3}{2}\\)."},
    {"id":"B7","title":"Bài 7: Ứng dụng đại số vào hình học – đại số hoá (tick ĐÚNG).","img":null,
      "items":[
        ["Thể tích hình hộp chữ nhật: \\(V=S_{\\text{đáy}}\\cdot h\\).",1],
        ["\\(S_{\\text{đáy}}=6x+8y^{2},\\,h=x+2\\Rightarrow V=(6x+8y^{2})(x+2)\\).",1],
        ["Nếu \\(S=6x^{2}-4xy\\), rộng \\(=2xy\\) thì dài \\(=\\dfrac{6x^{2}-4xy}{2xy}\\).",1],
        ["\\(\\dfrac{6x^{2}-4xy}{2xy}=\\dfrac{3x}{y}-2\\).",1],
        ["Diện tích <b>luôn</b> là đa thức theo \\(x,y\\).",0],
        ["Thể tích <b>luôn</b> là đa thức theo \\(x,y\\).",0],
        ["Có thể xuất hiện <b>phân thức</b> khi chia.",1],
        ["Quy đồng/rút gọn đúng giúp tránh sai sót.",1],
        ["Hệ số có thể là phân số.",1],
        ["\\(x/x\\) có thể rút gọn (với \\(x\\neq 0\\)).",1]
      ],
      "hint":"Áp dụng công thức S, V; khi chia có thể ra phân thức và cần rút gọn hợp lệ."},
    {"id":"B8","title":"Bài 8: Hình học – tứ giác, HBH, HCN, HT, HV (tick ĐÚNG).","img":"img/cau11(TL).png",
      "items":[
        ["Tổng góc tứ giác = \\(360^{\\circ}\\).",1],
        ["Trong HBH: \\(\\widehat{A}+\\widehat{B}=180^{\\circ}\\).",1],
        ["HCN có 4 góc vuông.",1],
        ["HCN có hai đường chéo vuông góc.",0],
        ["HCN có hai đường chéo <b>bằng nhau</b>.",1],
        ["Trong hình thang cân: hai góc ở <b>cùng một đáy</b> bằng nhau.",1],
        ["HBH: các cặp cạnh đối <b>song song</b>.",1],
        ["Hình thoi: 4 cạnh bằng nhau; chéo <b>vuông góc</b> và là phân giác các góc.",1],
        ["HV là giao của HCN và HT (vừa 4 góc vuông vừa 4 cạnh bằng).",1],
        ["Ví dụ hình 2: có hai đường chéo bằng nhau ⇒ nhận dạng <b>HCN</b> (chưa đủ để kết luận HV).",1]
      ],
      "hint":"Hệ thống tính chất chuẩn theo SGK; dùng đúng ký hiệu \\parallel, \\perp, \\widehat{\u00b7}."}
  ]
}
</script>

<script>
// ====== Small helpers ======
const $ = (s,root=document)=>root.querySelector(s);
const el = (tag,attrs={})=>{const e=document.createElement(tag);Object.assign(e,attrs);return e};
const tex = (node)=>{ if(window.MathJax) MathJax.typesetPromise([node]); };
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }
function deepCopy(obj){ return JSON.parse(JSON.stringify(obj)); }

// ====== State ======
let RAW = JSON.parse(document.getElementById('quiz-data').textContent);
let STATE = deepCopy(RAW);
let answeredMC = 0, scoreMC = 0;

function updateProgress(){
  const pm = `Trắc nghiệm: đúng ${scoreMC}/${STATE.mcqs.length} • Đ/S: tick đúng sẽ sáng xanh.`;
  $('#progress').textContent = pm;
}

function lockGroupByName(name){
  const list = document.getElementsByName(name);
  list.forEach?.(r=>r.disabled=true);
}

// ====== Render MCQs ======
function renderMCQs(){
  const mount = $('#mcqs');
  mount.innerHTML = '';
  answeredMC = 0; scoreMC = 0; updateProgress();

  STATE.mcqs.forEach((q,qi)=>{
    const card = el('div',{className:'card'});
    const stem = el('div',{className:'stem'});
    stem.innerHTML = `<span class="muted badge">Câu ${qi+1}</span> ${q.stem}`;
    card.appendChild(stem);
    if(q.img){ const im=el('img',{className:'figure',src:q.img,alt:'minh họa',loading:'lazy'}); card.appendChild(im); }

    q.options.forEach((op,oi)=>{
      const row = el('label',{className:'opt'});
      const i = el('input',{type:'radio',name:'mc_'+qi});
      const span = el('span'); span.innerHTML = op;
      i.addEventListener('change',()=>{
        lockGroupByName('mc_'+qi);
        const correct = (oi===q.answer);
        row.style.background = correct ? '#ecfeff' : '#fee2e2';
        row.insertAdjacentHTML('beforeend', ` <span class="badge ${correct?'ok':'bad'}">${correct?'ĐÚNG':'SAI'}</span>`);
        answeredMC++; if(correct) scoreMC++;
        // show hint
        if(hint.style.display!=='block'){hint.style.display='block'; tex(hint);}        
        updateProgress();
      });
      row.append(i,span); card.appendChild(row);
    });
    const hint=el('div',{className:'hint'}); hint.innerHTML = q.hint || '';
    const b=el('button',{className:'btn-ghost',textContent:'Gợi ý'});
    b.onclick=()=>{ hint.style.display = (hint.style.display==='block')?'none':'block'; tex(hint); };
    card.append(b,hint);

    mount.appendChild(card); tex(card);
  });
}

// ====== Render True/False blocks ======
function renderDS(){
  const root = $('#ds');
  root.innerHTML = '';
  STATE.ds.forEach((qs,idx)=>{
    const card = el('div',{className:'card'});
    const h = el('h2'); h.textContent = qs.title; card.appendChild(h);
    if(qs.img){ const im=el('img',{className:'figure',src:qs.img,alt:'minh họa',loading:'lazy'}); card.appendChild(im); }

    qs.items.forEach((it,i)=>{
      const row = el('label',{className:'opt'});
      const ck = el('input',{type:'checkbox'});
      const span = el('span'); span.innerHTML = it[0];
      ck.addEventListener('change',()=>{
        if(ck.checked){ row.style.background = (it[1]===1) ? '#ecfeff' : '#fee2e2';
          row.querySelector('.badge')?.remove();
          const tag = el('span',{className:'badge '+(it[1]===1?'ok':'bad')});
          tag.textContent = it[1]===1 ? 'ĐÚNG' : 'SAI';
          row.appendChild(tag);
        }else{ row.style.background='transparent'; row.querySelector('.badge')?.remove(); }
      });
      row.append(ck,span); card.appendChild(row);
    });

    const hint=el('div',{className:'hint'}); hint.innerHTML = qs.hint || '';
    const b=el('button',{className:'btn-ghost',textContent:'Gợi ý'});
    b.onclick=()=>{ hint.style.display = (hint.style.display==='block')?'none':'block'; tex(hint); };
    card.append(b,hint);

    root.appendChild(card); tex(card);
  });
}

// ====== Reset helpers ======
function resetQuiz(shuffleAll, onlyWrong=false){
  const d = deepCopy(RAW);
  if(onlyWrong){
    // Keep only MCQs that were not answered correctly in last render
    // We detect by looking for existing DOM badges with class .bad
    const badIndexes = [];
    document.querySelectorAll('#mcqs .card').forEach((c,idx)=>{
      const isBad = c.querySelector('.badge.bad');
      const isOk = c.querySelector('.badge.ok');
      if(isBad || !isOk) badIndexes.push(idx);
    });
    d.mcqs = badIndexes.map(i=>STATE.mcqs[i] || d.mcqs[i]).filter(Boolean);
  }
  if(shuffleAll){
    shuffle(d.mcqs);
    // shuffle options & update answer indices safely
    d.mcqs.forEach(q=>{
      const order = q.options.map((_,i)=>i); shuffle(order);
      q.options = order.map(i=>q.options[i]);
      q.answer = order.indexOf(q.answer);
    });
    shuffle(d.ds);
  }
  STATE = d;
  renderMCQs();
  renderDS();
}

// ====== Init ======
renderMCQs();
renderDS();
updateProgress();

$('#btnResetKeep').onclick = ()=>resetQuiz(false,false);
$('#btnResetShuffle').onclick = ()=>resetQuiz(true,false);
$('#btnOnlyWrong').onclick = ()=>resetQuiz(true,true);
$('#btnResetKeep2').onclick = ()=>resetQuiz(false,false);
$('#btnResetShuffle2').onclick = ()=>resetQuiz(true,false);
</script>
</body>
</html>
