<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ôn tập Giữa kì I – Toán 8</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" />
  <style>
    :root {
      --bg: #f6f8fc;
      --card: #fff;
      --ink: #1f2937;
      --muted: #6b7280;
      --brand: #2563eb;
      --hint: #e0f2fe;
    }
    html, body {
      margin: 0;
      background: var(--bg);
      color: var(--ink);
      font: 16px/1.6 system-ui, -apple-system, Segoe UI, Roboto;
    }
    .wrap { max-width: 960px; margin: auto; padding: 20px; }
    h1 { font-weight: 800; text-align: center; margin: 16px 0; }
    .note { color: var(--muted); text-align: center; margin-bottom: 20px; }
    .actions { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; }
    button {
      border: 0; border-radius: 10px; padding: 9px 14px; font-weight: 600;
      cursor: pointer; font-size: 15px;
    }
    .btn { background: var(--brand); color: #fff; }
    .btn-ghost { background: #e5e7eb; color: #111; }
    .section-title {
      font-size: 20px; font-weight: 700; text-align: center; margin: 30px 0 10px;
    }
    .card {
      background: var(--card); border-radius: 14px; box-shadow: 0 6px 20px rgba(0,0,0,.06);
      padding: 16px 18px; margin: 16px 0;
    }
    .stem { font-weight: 700; margin-bottom: 10px; }
    .opt {
      display: flex; gap: 10px; align-items: flex-start;
      padding: 8px 10px; border-radius: 10px;
    }
    .opt input { margin-top: 4px; }
    .hint {
      background: var(--hint); border-radius: 10px;
      padding: 10px 12px; margin-top: 8px; display: none;
    }
    img.figure { max-width: 100%; height: auto; border-radius: 8px; margin-top: 8px; }
  </style>

  <!-- MathJax for công thức -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" defer></script>
</head>
<body>
<div class="wrap">
  <h1>Ôn tập Giữa kì I – Toán 8</h1>
  <div class="note">Tích hợp MathJax để hiển thị công thức chuẩn và hình minh họa rõ nét.</div>

  <div class="actions">
    <button class="btn-ghost" onclick="resetQuiz(false)">Làm lại (giữ thứ tự)</button>
    <button class="btn" onclick="resetQuiz(true)">Làm lại (xáo trộn)</button>
  </div>

  <div id="mcqs"></div>
  <div class="section-title">PHẦN ĐÚNG / SAI</div>
  <div id="multi10"></div>

  <div class="actions">
    <button class="btn-ghost" onclick="resetQuiz(false)">Làm lại (giữ thứ tự)</button>
    <button class="btn" onclick="resetQuiz(true)">Làm lại (xáo trộn)</button>
  </div>
</div>

<script>
let DATA = null;

function $(sel, root=document){ return root.querySelector(sel); }
function el(tag, attrs={}){ const e=document.createElement(tag); Object.assign(e, attrs); return e; }
function tex(node){ if (window.MathJax) MathJax.typesetPromise([node]); }

function render(){
  const mc = $("#mcqs"), tl = $("#multi10");
  mc.innerHTML = ""; tl.innerHTML = "";

  // TRẮC NGHIỆM
  DATA.mcqs.forEach((q, qi)=>{
    const card = el("div",{className:"card"});
    const stem = el("div",{className:"stem"});
    stem.innerHTML = `<span style="color:#64748b">Câu ${qi+1}:</span> ${q.stem}`;
    card.appendChild(stem);
    if(q.img){ const im = el("img",{className:"figure",src:q.img,alt:"Hình minh họa"}); card.appendChild(im); }
    q.options.forEach((op, oi)=>{
      const row = el("label",{className:"opt"});
      const i = el("input",{type:"radio",name:"mc_"+qi});
      i.addEventListener("change",()=>{
        row.style.background = (oi===q.answer) ? "#ecfeff" : "#fee2e2";
      });
      const span = el("span"); span.innerHTML = op;
      row.append(i, span); card.appendChild(row);
    });
    const b = el("button",{className:"btn-ghost",textContent:"Gợi ý"});
    const hint = el("div",{className:"hint"}); hint.innerHTML = q.hint || "";
    b.onclick = ()=>{ hint.style.display="block"; tex(hint); };
    card.append(b,hint);
    mc.appendChild(card); tex(card);
  });

  // ĐÚNG / SAI
  DATA.multi10.forEach((qs, idx)=>{
    const card = el("div",{className:"card"});
    const stem = el("div",{className:"stem"});
    stem.innerHTML = `<b>${qs.title}</b>`;
    card.appendChild(stem);
    if(qs.img){ const im = el("img",{className:"figure",src:qs.img,alt:"Hình minh họa"}); card.appendChild(im); }
    qs.items.forEach((it,i)=>{
      const row = el("label",{className:"opt"});
      const ck = el("input",{type:"checkbox"});
      ck.addEventListener("change",()=>{
        row.style.background = (ck.checked ? (it[1]===1 ? "#ecfeff" : "#fee2e2") : "transparent");
      });
      const span = el("span"); span.innerHTML = it[0];
      row.append(ck, span); card.appendChild(row);
    });
    const b = el("button",{className:"btn-ghost",textContent:"Gợi ý"});
    const hint = el("div",{className:"hint"}); hint.innerHTML = qs.hint || "";
    b.onclick = ()=>{ hint.style.display="block"; tex(hint); };
    card.append(b,hint);
    tl.appendChild(card); tex(card);
  });
}

function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }
function resetQuiz(shuf){
  if(!DATA) return;
  const d = JSON.parse(JSON.stringify(DATA));
  if(shuf){ shuffle(d.mcqs); d.mcqs.forEach(q=>shuffle(q.options)); shuffle(d.multi10); }
  DATA = d; render();
}

// ⚡ Load dữ liệu JSON
fetch("./questions.json")
  .then(r => r.json())
  .then(json => { DATA = json; render(); })
  .catch(err => {
    document.body.innerHTML = "<h2 style='text-align:center;color:red'>Không tải được dữ liệu (questions.json)</h2><p style='text-align:center'>Vui lòng kiểm tra lại đường dẫn hoặc tên file.</p>";
    console.error(err);
  });
</script>
</body>
</html>
