<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ôn tập Giữa kì I – Toán 8</title>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
  <style>
    body{font-family:system-ui,Arial,sans-serif;background:#f8fafc;margin:0;color:#0f172a}
    h1{text-align:center;margin:18px 0 8px}
    .note{text-align:center;color:#64748b}
    .actions{text-align:center;margin:10px 0}
    button{margin:4px;padding:8px 14px;border:0;border-radius:8px;cursor:pointer;font-weight:600}
    .btn{background:#2563eb;color:#fff}
    .btn-ghost{background:#e2e8f0}
    .sec-title{text-align:center;font-size:20px;font-weight:700;margin-top:25px}
    .lead{text-align:center;color:#475569;margin-top:0}
    .card{background:#fff;margin:12px auto;padding:16px 18px;max-width:900px;border-radius:12px;box-shadow:0 3px 10px rgba(0,0,0,.05)}
    .stem{font-weight:700;margin-bottom:6px}
    .opt{display:flex;align-items:flex-start;gap:8px;padding:6px 8px;border-radius:8px}
    .opt:hover{background:#f1f5f9}
    .hint{display:none;margin-top:8px;padding:8px;background:#e0f2fe;border-radius:8px}
    img{max-width:100%;display:block;margin:8px auto;border-radius:8px}
    #resultbar{text-align:center;margin:10px 0;color:#0f172a}
  </style>
</head>
<body>
  <h1>Ôn tập Giữa kì I – Toán 8</h1>
  <p class="note" id="resultbar">Chọn đáp án, sau đó bấm <b>Chấm điểm</b> để xem kết quả.</p>

  <div class="actions">
    <button class="btn-ghost" id="btnKeep1">Làm lại (giữ thứ tự)</button>
    <button class="btn-ghost" id="btnShuffle1">Làm lại (xáo trộn)</button>
    <button class="btn" id="btnGrade">Chấm điểm</button>
  </div>

  <div class="sec-title">PHẦN TRẮC NGHIỆM</div>
  <p class="lead">Mỗi câu chọn 1 đáp án đúng.</p>
  <div id="mcqs"></div>

  <div class="sec-title">PHẦN MỆNH ĐỀ (CHỌN ĐÚNG)</div>
  <p class="lead">Chỉ đánh dấu vào mệnh đề <b>ĐÚNG</b>.</p>
  <div id="ds"></div>

  <div class="actions">
    <button class="btn-ghost" id="btnKeep2">Làm lại (giữ thứ tự)</button>
    <button class="btn" id="btnShuffle2">Làm lại (xáo trộn)</button>
  </div>

<script>
const DATA={
  "mcqs":[
    {"stem":"Trong các biểu thức sau, \\(\\textbf{đơn thức}\\) là:","options":["\\(2x^{2}+3y\\)","\\(\\frac{2}{3xy}\\)","\\((-5)x^{2}y^{3}\\)","\\(x^{2}-2x\\)"],"answer":2},
    {"stem":"Trong các biểu thức sau, \\(\\textbf{đa thức}\\) là:","options":["\\(\\frac{2}{x^{3}y}-1\\)","\\(\\frac{x}{y}+3\\)","\\(5x-4y+7\\)","\\(x^{2}y+\\frac{1}{x}\\)"],"answer":2}
  ],
  "multi10":[
    {"title":"Bài 1: Nhận biết mệnh đề đúng","items":[
      ["Đơn thức là tích của một số với các biến có số mũ nguyên không âm.",1],
      ["Hệ số của đơn thức có thể là phân số.",1],
      ["Đa thức có thể chứa biến ở mẫu.",0]
    ]}
  ]
};

const $=(s,r=document)=>r.querySelector(s);
const el=(t,a={})=>{const e=document.createElement(t);Object.assign(e,a);return e};
const clone=o=>JSON.parse(JSON.stringify(o));
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}
let RAW,STATE,picksMC=new Map(),picksDS=new Map();

function tex(n){if(window.MathJax)MathJax.typesetPromise([n]);}

function renderMC(){
  const m=$("#mcqs");m.innerHTML="";picksMC.clear();
  STATE.mcqs.forEach((q,qi)=>{
    const c=el("div",{className:"card"});
    const s=el("div",{className:"stem"});s.innerHTML=`Câu ${qi+1}: ${q.stem}`;c.appendChild(s);
    q.options.forEach((op,oi)=>{
      const r=el("label",{className:"opt"}),i=el("input",{type:"radio",name:"mc_"+qi});
      const sp=el("span");sp.innerHTML=op;
      i.addEventListener("change",()=>{picksMC.set(qi,oi);});
      r.append(i,sp);c.appendChild(r);
    });
    m.appendChild(c);tex(c);
  });
}

function renderDS(){
  const d=$("#ds");d.innerHTML="";picksDS.clear();
  STATE.ds.forEach((qs,bi)=>{
    const c=el("div",{className:"card"}),s=el("div",{className:"stem"});s.textContent=qs.title;c.appendChild(s);
    qs.items.forEach((it,i)=>{
      const truth=it[1]===1?1:0,r=el("label",{className:"opt"});
      const ck=el("input",{type:"checkbox"});
      const sp=el("span");sp.innerHTML=it[0];
      ck.addEventListener("change",()=>{
        if(!ck.checked)return r.style.background=""; 
        if(truth===1){r.style.background="#ecfeff";picksDS.set(`${bi}-${i}`,1);}
        else{r.style.background="#fee2e2";picksDS.set(`${bi}-${i}`,0);}
      });
      r.append(ck,sp);c.appendChild(r);
    });
    d.appendChild(c);tex(c);
  });
}

function gradeAll(){
  let ok1=0,t1=STATE.mcqs.length;
  $("#mcqs").querySelectorAll(".card").forEach((c,qi)=>{
    const ans=STATE.mcqs[qi].answer,p=picksMC.get(qi);
    c.querySelectorAll(".opt").forEach((r,oi)=>{
      if(oi===ans)r.style.outline="2px solid #10b981";
      if(p===oi)r.style.background=oi===ans?"#ecfeff":"#fee2e2";
    });
    if(p===ans)ok1++;
  });
  let ok2=0,t2=0;
  $("#ds").querySelectorAll(".card").forEach((c,bi)=>{
    c.querySelectorAll(".opt").forEach((r,i)=>{
      t2++;const ck=r.querySelector("input"),truth=STATE.ds[bi].items[i][1],p=picksDS.get(`${bi}-${i}`)||0;
      if(truth===1)r.style.outline="2px dashed #10b981";
      if(p===truth)ok2++;
    });
  });
  $("#resultbar").innerHTML=`<b>Kết quả:</b> Trắc nghiệm ${ok1}/${t1} • Mệnh đề ${ok2}/${t2} • Tổng ${ok1+ok2}/${t1+t2}`;
  window.scrollTo({top:0,behavior:"smooth"});
}

function resetAll(sh=false){
  const d=clone(RAW);
  if(sh){shuffle(d.mcqs);shuffle(d.ds);}
  STATE=d;renderMC();renderDS();
  $("#resultbar").textContent="Chọn đáp án, sau đó bấm Chấm điểm để xem kết quả.";
}

(function(){
  RAW={mcqs:DATA.mcqs,ds:DATA.multi10};
  STATE=clone(RAW);
  renderMC();renderDS();
  $("#btnGrade").onclick=gradeAll;
  $("#btnKeep1").onclick=()=>resetAll(false);
  $("#btnShuffle1").onclick=()=>resetAll(true);
  $("#btnKeep2").onclick=()=>resetAll(false);
  $("#btnShuffle2").onclick=()=>resetAll(true);
})();
</script>
</body>
</html>
